<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arbitrage Opportunities</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.css') }}">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <style>
        h1 {
            text-align: center;
            color: #0056b3;
            font-size: 2em;
            margin-top: 32px;
            margin-bottom: 18px;
            letter-spacing: 0.5px;
        }
        table.arb-table { border-collapse: collapse; width: 70%; margin: 30px auto; font-size: 0.98em; }
        .arb-table th, .arb-table td { border: 1px solid #aaa; padding: 7px 10px; text-align: center; }
        .arb-table th { background: #2196F3; color: #fff; font-size: 1.05em; }
        .arb-table tr:nth-child(even) { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 28px;">Arbitrage Opportunities</h1>
    <div style="text-align: center; margin-bottom: 18px;">
        <label for="product-select-simple" style="display: block; margin-bottom: 6px;">Select Product:</label>
        <select id="product-select-simple" style="margin: 0 auto; display: block; min-width: 180px; max-width: 320px; padding: 7px 12px; font-size: 1.05em; border-radius: 6px; border: 1.5px solid #90caf9;">
            {% for p in products %}
                <option value="{{ p }}" {% if p == selected_product %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
        </select>
    </div>
    <div id="top-bar" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0;">
        <div class="left-side">
            <a href="/arbitrage_chart_user?product={{ selected_product }}">
                <button id="view-chart-btn" class="nav-button" style="background: #fff; color: #1976D2; border: 2px solid #1976D2; border-radius: 8px; font-size: 1.02em; padding: 10px 22px; font-weight: 500; cursor: pointer; transition: background 0.2s, color 0.2s;">
                    üìà View Profit Chart
                </button>
            </a>
        </div>
        <div class="right-side" style="display: flex; flex-direction: column; align-items: flex-end;">
            <a id="pattern-stats-link" href="/pattern_stats_user?product={{ selected_product }}">
                <button id="pattern-stats-btn" class="nav-button" style="background: #fff; color: #1976D2; border: 2px solid #1976D2; border-radius: 8px; font-size: 1.02em; padding: 10px 22px; font-weight: 500; cursor: pointer; transition: background 0.2s, color 0.2s;">
                    üîç View ML Arbitrage Patterns
                </button>
            </a>
        </div>
    </div>
    <style>
        #pattern-stats-btn:hover, #view-chart-btn:hover {
            background: #1976D2;
            color: #fff;
        }
    </style>
    {% if opportunities %}
    <table id="arbitrageTable" class="arb-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Product</th>
                <th>Buy Market</th>
                <th>Buy Price</th>
                <th>Sell Market</th>
                <th>Sell Price</th>
                <th>Profit</th>
                <th>Profit %</th>
            </tr>
        </thead>
        <tbody>
            {% for opp in opportunities %}
            <tr>
                <td>{{ opp.date }}</td>
                <td>{{ opp.commodity_name }}</td>
                <td>{{ opp.market_buy }}</td>
                <td>{{ opp.price_buy }}</td>
                <td>{{ opp.market_sell }}</td>
                <td>{{ opp.price_sell }}</td>
                <td>{{ opp.profit }}</td>
                <td>{{ opp.profit_percent }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p style="text-align: center;">No opportunities found for selected product.</p>
    {% endif %}
    <script>
        // Dropdown change navigation
        document.getElementById('product-select-simple').addEventListener('change', function () {
            const selectedProduct = this.value;
            if (selectedProduct) {
                window.location.href = '/arbitrage_simple_user?product=' + encodeURIComponent(selectedProduct);
            }
            // Also update the pattern stats button link
            document.getElementById('pattern-stats-link').href = '/pattern_stats_user?product=' + encodeURIComponent(selectedProduct);
        });
        // Update the pattern stats button link on page load
        document.getElementById('pattern-stats-link').href = '/pattern_stats_user?product=' + encodeURIComponent(document.getElementById('product-select-simple').value);
        // Initialize DataTable without search
        $(document).ready(function () {
            $('#arbitrageTable').DataTable({
                pageLength: 75,
                order: [[0, 'asc']],
                searching: false,
                lengthChange: false,
            });
        });
    </script>
</body>
<a href="/logout" class="logout-btn">Logout</a>
<a href="/dashboard_user" class="back-btn">‚¨ÖÔ∏è Back to Previous Page</a>
</html> 